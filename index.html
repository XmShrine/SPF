<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SPF - Symmetric Polynomial Factorization</title>
    
    <script>
        MathJax = {
          tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']], 
            displayMath: [['$$', '$$'], ['\\[', '\\]']] 
          },
          svg: {
            fontCache: 'global'
          },
          options: {
            renderActions: {
              assistiveMml: [], 
              addMenu: [],
              sre: []
            }
          }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- å‡è®¾ SPF.js åœ¨åŒçº§ç›®å½• -->
    <script type="text/JavaScript" src="SPF.js"></script>

    <style>
        /* ---------------------------------------------------------- */
        /*  iOS Vision / Future OS Design Language                    */
        /* ---------------------------------------------------------- */
        
        :root {
            /* æ ¸å¿ƒè‰²æ¿ */
            --ios-bg-gradient: radial-gradient(circle at 50% 0%, #2c3e50 0%, #000000 100%);
            --ios-card-bg: rgba(28, 28, 30, 0.65);
            --ios-card-border: rgba(255, 255, 255, 0.12);
            --ios-card-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            
            --ios-primary: #0A84FF;
            --ios-primary-hover: #409CFF;
            --ios-primary-dim: rgba(10, 132, 255, 0.15);
            
            --ios-text-primary: #FFFFFF;
            --ios-text-secondary: rgba(235, 235, 245, 0.6);
            --ios-text-tertiary: rgba(235, 235, 245, 0.3);
            
            --ios-input-bg: rgba(0, 0, 0, 0.2);
            --ios-input-border: rgba(255, 255, 255, 0.1);
            
            --radius-l: 24px;
            --radius-m: 16px;
            --radius-s: 10px;
            
            --blur-level: 40px;
            --font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: var(--font-family);
            background: #000;
            background-image: var(--ios-bg-gradient);
            background-attachment: fixed;
            color: var(--ios-text-primary);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .container {
            width: 100%;
            max-width: 720px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            z-index: 1;
        }

        /* ----------------------------------- */
        /* å¡ç‰‡é€šç”¨æ ·å¼ (Glassmorphism) */
        /* ----------------------------------- */
        .card {
            background-color: var(--ios-card-bg);
            border-radius: var(--radius-l);
            padding: 28px;
            /* æ ¸å¿ƒï¼šèƒŒæ™¯æ¨¡ç³Šä¸é¥±å’Œåº¦æå‡ */
            backdrop-filter: blur(var(--blur-level)) saturate(180%);
            -webkit-backdrop-filter: blur(var(--blur-level)) saturate(180%);
            border: 1px solid var(--ios-card-border);
            box-shadow: var(--ios-card-shadow);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* å¤´éƒ¨æ ·å¼ */
        .header-card {
            text-align: center;
            background-color: transparent;
            border: none;
            box-shadow: none;
            backdrop-filter: none;
            -webkit-backdrop-filter: none;
            padding: 10px 0;
        }

        .header-card h1 {
            font-size: 32px;
            font-weight: 700;
            margin: 0 0 8px 0;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, #fff 0%, #a5a5a5 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-card p {
            color: var(--ios-text-secondary);
            font-size: 15px;
            font-weight: 500;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        /* ----------------------------------- */
        /* æ¨¡å¼é€‰æ‹©å™¨ (Segmented Control) */
        /* ----------------------------------- */
        .mode-selector {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .mode-selector label:first-child {
            font-size: 13px;
            font-weight: 600;
            color: var(--ios-text-secondary);
            margin-left: 4px;
            text-transform: uppercase;
        }

        .mode-buttons {
            display: flex;
            background-color: rgba(118, 118, 128, 0.24); /* iOS Segmented Control BG */
            border-radius: 14px; /* iOS standard pill radius is slightly smaller */
            padding: 3px;
            position: relative;
            /* æ¶ˆé™¤è¾¹æ¡†ä»¥æ¨¡ä»¿åŸç”Ÿæ§ä»¶ */
            border: none; 
        }

        .mode-buttons input[type="radio"] {
            display: none;
        }

        .mode-buttons label {
            flex: 1;
            text-align: center;
            padding: 8px 10px;
            font-size: 14px;
            font-weight: 500;
            color: var(--ios-text-secondary);
            cursor: pointer;
            border-radius: 11px; /* Slightly smaller than container */
            transition: all 0.25s cubic-bezier(0.2, 0.8, 0.2, 1);
            position: relative;
            z-index: 2;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* é€‰ä¸­çŠ¶æ€ - æ‚¬æµ®å¡ç‰‡æ•ˆæœ */
        .mode-buttons input[type="radio"]:checked + label {
            background-color: rgba(255, 255, 255, 1); /* çº¯ç™½ */
            color: #000; /* é»‘è‰²æ–‡å­—å¯¹æ¯”åº¦æœ€é«˜ */
            font-weight: 600;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15), 0 1px 1px rgba(0,0,0,0.1); /* æµ®èµ·é˜´å½± */
        }
        
        .mode-buttons input[type="radio"]:checked + label:active {
             transform: scale(0.97); /* æŒ‰ä¸‹å¾®ç¼© */
        }

        /* ----------------------------------- */
        /* è¾“å…¥åŒºåŸŸ */
        /* ----------------------------------- */
        
        /* Nå€¼è¾“å…¥å®¹å™¨ */
        #n-input-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--ios-input-bg);
            padding: 12px 16px;
            border-radius: var(--radius-m);
            margin-bottom: 20px;
            border: 1px solid var(--ios-input-border);
            transition: border-color 0.2s;
        }
        
        #n-input-container:focus-within {
            border-color: var(--ios-primary);
            background: rgba(0, 0, 0, 0.3);
        }

        #n-input-container label {
            color: var(--ios-text-primary);
            font-size: 15px;
            font-weight: 500;
        }

        #polyTotalNum {
            background: transparent;
            border: none;
            color: var(--ios-primary);
            font-size: 18px;
            font-weight: 600;
            text-align: right;
            width: 80px;
            outline: none;
            font-family: monospace; /* æ•°å­—ç­‰å®½ */
        }

        /* ä¸»è¾“å…¥åŒºåŸŸ */
        .input-area {
            display: flex;
            gap: 16px;
            align-items: stretch;
        }

        #polyInput {
            flex-grow: 1;
            width: 100%;
            min-height: 120px;
            padding: 16px;
            background-color: var(--ios-input-bg);
            border: 1px solid var(--ios-input-border);
            border-radius: var(--radius-m);
            color: var(--ios-text-primary);
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace; /* ä»£ç å­—ä½“ */
            font-size: 15px;
            line-height: 1.5;
            resize: vertical;
            outline: none;
            transition: all 0.2s;
        }

        #polyInput:focus {
            border-color: var(--ios-primary);
            background-color: rgba(0,0,0,0.3);
            box-shadow: 0 0 0 4px var(--ios-primary-dim);
        }

        #polyInput:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: rgba(255,255,255,0.05);
        }

        /* åˆ†è§£æŒ‰é’® */
        .action-button {
            background: var(--ios-primary);
            color: white;
            border: none;
            border-radius: var(--radius-m);
            padding: 0 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1); /* å¼¹æ€§åŠ¨ç”» */
            min-width: 90px;
            box-shadow: 0 4px 12px rgba(10, 132, 255, 0.4);
        }

        .action-button:hover {
            background: var(--ios-primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(10, 132, 255, 0.5);
        }

        .action-button:active {
            transform: scale(0.94);
            box-shadow: 0 2px 8px rgba(10, 132, 255, 0.3);
        }

        .action-button .icon {
            font-size: 24px;
            margin-bottom: 6px;
        }
        
        .action-button .text {
            font-size: 13px;
            opacity: 0.9;
        }

        /* ----------------------------------- */
        /* è¾“å‡ºåŒºåŸŸ */
        /* ----------------------------------- */
        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 16px;
            margin-bottom: 16px;
            border-bottom: 1px solid var(--ios-card-border);
        }

        .output-area h2 {
            font-size: 17px;
            font-weight: 600;
            margin: 0;
            color: var(--ios-text-primary);
        }

        .copy-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* ä¸‹æ‹‰é€‰æ‹©æ¡†ç¾åŒ– */
        #copyModeSelect {
            appearance: none;
            background-color: rgba(118, 118, 128, 0.24);
            color: var(--ios-text-primary);
            border: none;
            border-radius: 8px;
            padding: 6px 30px 6px 12px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            /* è‡ªå®šä¹‰ç®­å¤´ SVG */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%238E8E93' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            transition: background-color 0.2s;
        }
        
        #copyModeSelect:hover {
            background-color: rgba(118, 118, 128, 0.35);
        }
        
        #copyModeSelect:focus {
            outline: none;
            background-color: rgba(118, 118, 128, 0.4);
        }

        /* å¤åˆ¶æŒ‰é’® */
        #copyBtn {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--ios-primary);
            border: none;
            border-radius: 8px;
            padding: 6px 16px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        #copyBtn:hover {
            background-color: rgba(10, 132, 255, 0.15);
        }
        
        #copyBtn:active {
            transform: scale(0.96);
        }

        /* è¾“å‡ºç»“æœæ¡† */
        .output-box {
            min-height: 120px;
            max-height: 400px;
            overflow-y: auto;
            padding: 20px;
            background-color: #000; /* æ·±é»‘èƒŒæ™¯å¢åŠ å¯¹æ¯”åº¦ */
            border: 1px solid var(--ios-card-border);
            border-radius: var(--radius-m);
            font-size: 18px;
            color: var(--ios-text-primary);
            display: flex;
            align-items: center; /* å†…å®¹å‚ç›´å±…ä¸­ */
            justify-content: center; /* å†…å®¹æ°´å¹³å±…ä¸­ */
            position: relative;
        }

        /* MathJax æ ·å¼è°ƒæ•´ - ç¡®ä¿æ•°å­¦å…¬å¼æ¸…æ™° */
        .output-box .mjx-chtml {
            font-size: 110% !important;
            color: #fff !important;
        }
        
        /* ç­‰å¾…è¾“å…¥çš„å ä½ç¬¦æ ·å¼ */
        .output-box span[style*="secondary"] {
            color: var(--ios-text-secondary) !important;
            font-size: 14px;
            font-weight: 400;
        }

        /* ----------------------------------- */
        /* å¸®åŠ©æŒ‰é’®ä¸æ¨¡æ€æ¡† */
        /* ----------------------------------- */
        .info-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(30, 30, 30, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            color: var(--ios-primary);
            font-size: 22px;
            font-weight: 500;
            border: 1px solid var(--ios-card-border);
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .info-button:hover {
            background: var(--ios-primary);
            color: white;
            transform: scale(1.1);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 200;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            margin: 10% auto;
            width: 85%;
            max-width: 500px;
            position: relative;
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            /* æ¨¡æ€æ¡†ç‰¹æœ‰æ ·å¼ */
            background: #1c1c1e;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .close-button {
            color: rgba(255,255,255,0.3);
            float: right;
            font-size: 28px;
            font-weight: 400;
            transition: color 0.2s;
            margin-top: -5px;
        }

        .close-button:hover {
            color: #fff;
            cursor: pointer;
        }
        
        .modal-body h2 {
            font-size: 20px;
            margin-top: 0;
            color: #fff;
        }
        
        .modal-body hr {
            border: 0;
            height: 1px;
            background: rgba(255,255,255,0.1);
            margin: 15px 0;
        }

        /* ----------------------------------- */
        /* ç§»åŠ¨ç«¯é€‚é… */
        /* ----------------------------------- */
        @media (max-width: 600px) {
            body {
                padding: 16px 12px;
            }
            
            .card {
                padding: 20px;
                border-radius: 20px;
            }
            
            .mode-selector {
                gap: 8px;
            }
            
            .mode-buttons {
                flex-direction: column; /* æ‰‹æœºä¸Šå‚ç›´æ’åˆ—ï¼Œç¡®ä¿æ˜“ç‚¹ */
                background-color: transparent;
                padding: 0;
                gap: 8px;
            }
            
            .mode-buttons label {
                background-color: rgba(118, 118, 128, 0.24);
                border-radius: 12px;
                padding: 12px;
                font-size: 15px;
            }
            
            .mode-buttons input[type="radio"]:checked + label {
                background-color: var(--ios-primary); /* æ‰‹æœºç«¯é€‰ä¸­ç”¨è“è‰²é«˜äº®ï¼Œæ›´æ˜æ˜¾ */
                color: white;
            }
            
            .input-area {
                flex-direction: column;
            }
            
            .action-button {
                flex-direction: row;
                padding: 14px;
                min-height: 50px;
                width: 100%;
            }
            
            .action-button .icon {
                margin-bottom: 0;
                margin-right: 8px;
                font-size: 20px;
            }
            
            .output-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            
            .copy-controls {
                width: 100%;
                justify-content: space-between;
            }
            
            #copyModeSelect, #copyBtn {
                flex: 1;
                justify-content: center;
                display: flex;
                text-align: center;
            }
        }

        /* åŠ¨ç”»å®šä¹‰ */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(40px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* é€‰ä¸­æ–‡å­—é¢œè‰² */
        ::selection {
            background: rgba(10, 132, 255, 0.4);
            color: white;
        }

    </style>
</head>
<body>

    <div class="container">
        <header class="card header-card">
            <h1>å¯¹ç§°å¤šé¡¹å¼åˆç­‰åˆ†è§£</h1>
            <p>C++ 30 å°ç»„</p>
        </header>

        <div class="main-content card">
            
            <div class="mode-selector">
                <label>åˆ†è§£æ¨¡å¼</label>
                <div class="mode-buttons">
                    <input type="radio" id="mode1" name="polyMode" value="1" checked>
                    <label for="mode1">ç»å…¸æ¨¡å¼ (Classic)</label>
                    
                    <input type="radio" id="mode2" name="polyMode" value="2">
                    <label for="mode2">ä¹˜ç§¯æ¨¡å¼ (Product)</label>
                    
                    <input type="radio" id="mode3" name="polyMode" value="3">
                    <label for="mode3">åŠ å’Œæ¨¡å¼ (Sum)</label>
                </div>
            </div>

            <div id="n-input-container" style="display: none;">
                <label for="polyTotalNum">å˜é‡æ€»æ•° N</label>
                <input type="number" id="polyTotalNum" min="1" placeholder="0" value=""> 
            </div>

            <div class="input-area">
                <textarea id="polyInput" placeholder="è¾“å…¥å¤šé¡¹å¼ï¼Œä¾‹å¦‚: x1^2 + x2^2 ..." rows="5" disabled></textarea> 
                <button id="submitBtn" class="action-button">
                    <span class="icon"></span>
                    <span class="text">åˆ†è§£</span>
                </button>
            </div>
            
        </div>

        <div class="output-area card">
            
            <div class="output-header">
                <h2>è¿ç®—ç»“æœ</h2>
                <div class="copy-controls">
                    <select id="copyModeSelect">
                        <option value="latex">LaTeX æ ¼å¼</option>
                        <option value="raw">çº¯æ–‡æœ¬</option>
                    </select>
                    <button id="copyBtn" title="å¤åˆ¶ç»“æœ">å¤åˆ¶</button>
                </div>
            </div>
            
            <div id="polyOutput" class="output-box" data-mathjax-ignore>
                <span style="color: var(--ios-text-tertiary);"></span>
            </div>
        </div>
    </div>

    <button id="infoBtn" class="info-button">?</button>

    <div id="infoModal" class="modal">
        <div class="modal-content card">
            <span class="close-button">&times;</span>
            <div class="modal-body">
                <h2>ğŸ“˜ å¸®åŠ©ä¸æç¤º</h2>
                <hr>
                <p>åœ¨æ­¤å¤„æŸ¥çœ‹å¤šé¡¹å¼è¾“å…¥è§„åˆ™ã€‚</p>
                <p style="color: var(--ios-text-secondary); font-size: 14px;">ç›®å‰æ”¯æŒ LaTeX æ¸²æŸ“é¢„è§ˆä¸ä¸€é”®å¤åˆ¶åŠŸèƒ½ã€‚</p>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡ï¼Œç”¨äºå­˜å‚¨ DealPoly è¿”å›çš„åŸå§‹ç»“æœå­—ç¬¦ä¸²å’Œ N å€¼
        let temp = "ç­‰å¾…è¾“å…¥..."; 
        let tempPoly = null; // ç”¨äºå­˜å‚¨å¤šé¡¹å¼å¯¹è±¡
        let polyTotalNum = 0; // å­˜å‚¨ N çš„å€¼
        
        // *** DOM å…ƒç´ å¼•ç”¨ ***
        const polyInput = document.getElementById('polyInput');
        const submitBtn = document.getElementById('submitBtn');
        const polyOutput = document.getElementById('polyOutput');
        const modeRadios = document.querySelectorAll('input[name="polyMode"]');
        const copyBtn = document.getElementById('copyBtn');
        const copyModeSelect = document.getElementById('copyModeSelect');
        const infoBtn = document.getElementById('infoBtn');
        const infoModal = document.getElementById('infoModal');
        const closeButton = document.querySelector('.close-button');
        
        // æ–°å¢çš„ N å€¼è¾“å…¥å…ƒç´ 
        const nInputContainer = document.getElementById('n-input-container');
        const nInput = document.getElementById('polyTotalNum');

        // åˆå§‹åŒ–æ—¶ï¼Œå¦‚æœé»˜è®¤æ˜¯æ¨¡å¼1ï¼Œåˆ™å¯ç”¨å¤šé¡¹å¼è¾“å…¥
        if (document.getElementById('mode1').checked) {
            polyInput.disabled = false;
        }


        // *** æ ¸å¿ƒé€»è¾‘å‡½æ•° ***

        // è¾…åŠ©å‡½æ•°ï¼šæ ¹æ® nInput çš„å€¼æ§åˆ¶ polyInput çš„å¯ç”¨/ç¦ç”¨çŠ¶æ€
        function updatePolyInputState() {
            const currentMode = document.querySelector('input[name="polyMode"]:checked').value;
            
            if (currentMode === '1') {
                // æ¨¡å¼1ï¼ˆç»å…¸æ¨¡å¼ï¼‰ï¼šå§‹ç»ˆå¯ç”¨
                polyInput.disabled = false;
                polyTotalNum = 0; // ç»å…¸æ¨¡å¼ä¸‹ n æ— æ„ä¹‰
                polyInput.placeholder = "æŒ‰è§„åˆ™è¾“å…¥è¦åˆ†è§£çš„å¯¹ç§°å¤šé¡¹å¼...";
            } else {
                // æ¨¡å¼2/3ï¼ˆä¹˜ç§¯/åŠ å’Œæ¨¡å¼ï¼‰ï¼šä¾èµ– n çš„å€¼
                const nValue = parseInt(nInput.value);
                polyInput.placeholder = "åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œè¯·è¾“å…¥ç›¸å…³å‚æ•°...";
                
                if (nValue > 0) {
                    polyInput.disabled = false;
                    polyTotalNum = nValue;
                } else {
                    polyInput.disabled = true;
                    polyTotalNum = 0;
                    if (nInput.value.trim() !== '') {
                         // åªæœ‰å½“Nè¾“å…¥æ¡†è¢«ä¿®æ”¹ä½†å€¼æ— æ•ˆæ—¶æ‰æç¤º
                         polyOutput.innerHTML = '<span style="color: var(--ios-text-secondary);">è¯·åœ¨ä¸Šæ–¹è¾“å…¥å¤§äº 0 çš„å˜é‡æ€»æ•° Nã€‚</span>';
                         if (window.MathJax) {
                             MathJax.typesetPromise([polyOutput]).catch((err) => console.log('MathJax Typeset Error: ' + err.message));
                         }
                    }
                }
            }
        }
        
        /**
         * è¾…åŠ©å‡½æ•°ï¼šå°†å¤šé¡¹å¼å•é¡¹å¼è½¬æ¢ä¸º LaTeX æ ¼å¼
         */
        function MonoToTex(mono) {
            var result = "";
            // ç¡®ä¿ç³»æ•°ä¸ä¸º 1 æ—¶æ˜¾ç¤ºï¼Œå¦‚æœä¸º -1 åˆ™åªæ˜¾ç¤º -
            if (mono.coeff !== 1) {
                if (mono.coeff === -1 && mono.variable.some(v => v !== 0)) {
                    result = "-";
                } else {
                    result = `${mono.coeff}`;
                }
            } else if (mono.coeff === -1 && !mono.variable.some(v => v !== 0)) {
                 result = "-1"; // å¸¸æ•° -1
            }
            
            // æ‹¼æ¥å˜é‡
            for (var i = 0; i < mono.variable.length; i++) {
                if (mono.variable[i] !== 0) {
                    result = result + `\\sigma_{${i+1}}`;
                    if (mono.variable[i] > 1) {
                        result = result + `^{${mono.variable[i]}}`;
                    }
                }
            }
            
            // å¦‚æœç³»æ•°æ˜¯ 1ï¼Œä½†å˜é‡éƒ¨åˆ†ä¸ºç©ºï¼ˆå¸¸æ•°é¡¹ 1ï¼‰ï¼Œåˆ™æ‰‹åŠ¨åŠ ä¸Š 1
            if (mono.coeff === 1 && result === "") {
                result = "1";
            }
            
            return result;
        }
        
        /**
         * è¾…åŠ©å‡½æ•°ï¼šå°†å¤šé¡¹å¼å¯¹è±¡è½¬æ¢ä¸º LaTeX å—çº§å…¬å¼
         */
        function PolyToTex(poly) {
            if (!poly || !poly.arr || poly.arr.length === 0) return "$$0$$";

            var result = "$$";
            for (var i = 0; i < poly.arr.length; i++) {
                const mono = poly.arr[i];
                const monoTex = MonoToTex(mono);
                
                // å¤„ç†åŠ å·ï¼šå¦‚æœä¸æ˜¯ç¬¬ä¸€é¡¹ä¸”ç³»æ•°å¤§äº 0ï¼Œåˆ™æ·»åŠ  + å·
                if (i > 0 && mono.coeff > 0) {
                    result = result + "+";
                }
                
                result = result + monoTex;
            }
            result = result + "$$";
            return result;
        }

        /**
         * æ ¸å¿ƒï¼šå¤„ç†è¾“å…¥å¹¶è°ƒç”¨å¤–éƒ¨ SPF åº“
         */
        function DealPoly(input, mode) {
            console.log(`å¤„ç†è¾“å…¥: "${input}", æ¨¡å¼: ${mode}, N=${polyTotalNum}`);
            
            if (!input.trim()) {
                return "è¯·è¾“å…¥ä¸€ä¸ªå¤šé¡¹å¼";
            }
            
            // å‡è®¾ SPF.js ä¸­çš„å‡½æ•°å­˜åœ¨
            if (typeof SPF !== 'function' || typeof "".toPolynomial !== 'function') {
                // å¦‚æœ SPF æœªåŠ è½½ï¼Œè¿”å›æ¨¡æ‹Ÿæ•°æ®ä»¥ä¾›æ¼”ç¤º UI æ•ˆæœ
                if (mode === '1') return `$$ \\text{Demo: } \\sigma_1^2 - 2\\sigma_2 $$`;
                return "é”™è¯¯ï¼šå¤–éƒ¨ä¾èµ– SPF.js æˆ– toPolynomial() æœªåŠ è½½ã€‚";
            }

            // è°ƒç”¨å¤–éƒ¨å‡½æ•°ï¼Œä¼ å…¥ N å€¼
            try {
                // å‡è®¾ input.toPolynomial() è¿”å›ä¸€ä¸ªå¤šé¡¹å¼å¯¹è±¡
                const inputPoly = input.toPolynomial(); 
                tempPoly = SPF(inputPoly, polyTotalNum); 
            } catch (e) {
                console.error("Polynomial processing error:", e);
                return `å¤„ç†å¤šé¡¹å¼æ—¶å‡ºé”™: ${e.message || e}`;
            }

            
            // ç¤ºä¾‹è¾“å‡ºï¼ŒMathJax é»˜è®¤æ”¯æŒ $...$ å’Œ $$...$$
            const sampleOutput = {
                1: (tempPoly==false) ? "$\\text{Not a Sym Polynomial}$" : PolyToTex(tempPoly),
                2: `ä¹˜ç§¯æ¨¡å¼ (${polyTotalNum} å˜é‡) ç»“æœï¼š$$\\frac{1}{2}\\sigma_1 (\\sigma_1^2 - 3\\sigma_2) + \\sigma_3$$`,
                3: `åŠ å’Œæ¨¡å¼ (${polyTotalNum} å˜é‡) ç»“æœï¼š$$(\\sigma_1 - x_1)(\\sigma_1 - x_2)\\dots(\\sigma_1 - x_{N})$$`
            };
            
            return sampleOutput[mode] || "æ¨¡å¼é”™è¯¯æˆ–å¤„ç†å¤±è´¥ã€‚";
        }

        // æ ¸å¿ƒå‡½æ•°ï¼šå¤„ç†è¾“å…¥å¹¶æ›´æ–°æ˜¾ç¤º
        function processInput() {
            // åªæœ‰åœ¨å¤šé¡¹å¼è¾“å…¥æ¡†å¯ç”¨æ—¶æ‰æ‰§è¡Œåˆ†è§£
            if (polyInput.disabled) {
                const currentMode = document.querySelector('input[name="polyMode"]:checked').value;
                if (currentMode !== '1') {
                    if (window.MathJax) {
                       MathJax.typesetPromise([polyOutput]).catch((err) => console.log('MathJax Typeset Error: ' + err.message));
                    }
                }
                return;
            }

            const input = polyInput.value;
            let mode = document.querySelector('input[name="polyMode"]:checked').value;
            
            const result = DealPoly(input, mode);
            
            // 1. å°† DealPoly çš„åŸå§‹ç»“æœå­˜å…¥ temp å˜é‡
            temp = result;

            // 2. æ›´æ–°è¾“å‡ºæ¡†å†…å®¹
            polyOutput.innerHTML = result;
            
            // 3. è°ƒç”¨ MathJax é‡æ–°æ¸²æŸ“è¯¥å…ƒç´ 
            if (window.MathJax) {
                 MathJax.typesetPromise([polyOutput]).catch((err) => console.log('MathJax Typeset Error: ' + err.message));
            } else {
                 console.error("MathJax object is not available.");
            }
        }
        
        // æ ¸å¿ƒå‡½æ•°ï¼šå¤åˆ¶ç»“æœ
        function copyResult() {
            const copyMode = copyModeSelect.value;
            let textToCopy = "";

            // å¦‚æœ tempPoly ä¸ºç©ºä½† polyOutput æœ‰å†…å®¹ (ä¾‹å¦‚ demo æ¨¡å¼æˆ– SPF åº“æœªåŠ è½½æ—¶çš„æ–‡æœ¬)
            if (tempPoly === null && polyOutput.innerText.length > 10) {
                textToCopy = polyOutput.innerText;
            } else if (tempPoly === null) {
                alert("è¯·å…ˆè¿›è¡Œåˆ†è§£ä»¥ç”Ÿæˆç»“æœã€‚");
                return;
            } else {
                if (copyMode === "latex") {
                    textToCopy = PolyToTex(tempPoly);
                } else if (copyMode === "raw") {
                    textToCopy = tempPoly.toString();
                }
            }
            
            // ä½¿ç”¨ Clipboard API è¿›è¡Œå¤åˆ¶
            navigator.clipboard.writeText(textToCopy)
                .then(() => {
                    // æˆåŠŸåï¼Œæ›´æ–°æŒ‰é’®æ–‡å­—æç¤º
                    const originalText = copyBtn.textContent;
                    copyBtn.textContent = 'å·²å¤åˆ¶ âœ“'; 
                    setTimeout(() => {
                        copyBtn.textContent = originalText;
                    }, 1500);
                })
                .catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    // Fallback
                    alert('å¤åˆ¶å†…å®¹: \n' + textToCopy);
                });
        }
        

        // *** äº‹ä»¶ç›‘å¬å™¨ ***
        
        // 1. æ¨¡å¼é€‰æ‹©ç›‘å¬å™¨ï¼šæ§åˆ¶ N è¾“å…¥æ¡†çš„æ˜¾ç¤ºå’Œå¤šé¡¹å¼è¾“å…¥æ¡†çš„å¯ç”¨
        modeRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                const selectedMode = e.target.value;
                if (selectedMode === '1') {
                    nInputContainer.style.display = 'none';
                    nInput.value = ''; // æ¸…ç©º N å€¼
                    updatePolyInputState(); // æ¨¡å¼1ç›´æ¥å¯ç”¨å¤šé¡¹å¼è¾“å…¥
                } else {
                    nInputContainer.style.display = 'flex';
                    // è§¦å‘é‡æ’ä»¥åº”ç”¨ Flex å¸ƒå±€
                    updatePolyInputState(); // æ¨¡å¼2/3ä¾èµ– N å€¼
                    // å¦‚æœ nInput.value ä¸ºç©ºï¼Œæç¤ºç”¨æˆ·è¾“å…¥ N
                }
            });
        });
        
        // 2. N è¾“å…¥æ¡†ç›‘å¬å™¨ï¼šå®æ—¶æ§åˆ¶å¤šé¡¹å¼è¾“å…¥æ¡†çš„å¯ç”¨/ç¦ç”¨
        nInput.addEventListener('input', updatePolyInputState);

        // 3. æŒ‰é’®å’ŒåŠŸèƒ½ç›‘å¬å™¨
        submitBtn.addEventListener('click', processInput);
        copyBtn.addEventListener('click', copyResult); 

        // 4. æ¨¡æ€æ¡†é€»è¾‘ (ä¿æŒä¸å˜)
        infoBtn.addEventListener('click', () => {
            infoModal.style.display = 'block';
        });

        closeButton.addEventListener('click', () => {
            infoModal.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target == infoModal) {
                infoModal.style.display = 'none';
            }
        });

        // åˆå§‹çŠ¶æ€è®¾ç½®ï¼šç¡®ä¿å¤šé¡¹å¼è¾“å…¥æ¡†æ ¹æ®é»˜è®¤é€‰ä¸­çš„æ¨¡å¼ï¼ˆæ¨¡å¼1ï¼‰å¯ç”¨
        updatePolyInputState();
        
    </script>
</body>
</html>